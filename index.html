<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/lib/index.min.js">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markdown-it-texmath@0.6.5/css/texmath.css">
  <link rel="stylesheet" href="https://gitcdn.xyz/repo/goessner/mdmath/master/css/vscode-texmath.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <style>
        img{
          display: block;
          margin-left: auto;
          margin-right: auto;
        }
    </style>
</head>

<body class="markdown-body container">

  
  <h1 id="project-architecture---reinforcement-learning-in-an-imagined-latent-state" data-line="0" class="code-line">
    Project Architecture - Reinforcement Learning in an Imagined Latent State</h1>
  <!-- TOC -->
  <ul>
    <li data-line="3" class="code-line"><a href="#prior-setup" data-href="#prior-setup">Prior Setup</a>
      <ul>
        <li data-line="4" class="code-line"><a href="#initial-data-collection"
            data-href="#initial-data-collection">Initial Data Collection</a></li>
        <li data-line="5" class="code-line"><a href="#reward-signal-formulation"
            data-href="#reward-signal-formulation">Reward Signal formulation</a></li>
        <li data-line="6" class="code-line"><a href="#dataset-constructionconsolidation"
            data-href="#dataset-constructionconsolidation">Dataset Construction/Consolidation</a></li>
      </ul>
    </li>
    <li data-line="7" class="code-line"><a href="#maintenance-detection-model"
        data-href="#maintenance-detection-model">Maintenance Detection Model</a>
      <ul>
        <li data-line="8" class="code-line"><a href="#maintenance-requirements"
            data-href="#maintenance-requirements">Maintenance Requirements</a></li>
        <li data-line="9" class="code-line"><a href="#detection-model" data-href="#detection-model">Detection Model</a>
        </li>
        <li data-line="10" class="code-line"><a href="#quality-estimator" data-href="#quality-estimator">Quality
            Estimator</a></li>
      </ul>
    </li>
    <li data-line="11" class="code-line"><a href="#state-encoder-se" data-href="#state-encoder-se">State Encoder
        (SE)</a>
      <ul>
        <li data-line="12" class="code-line"><a href="#sim-to-real-adaptation" data-href="#sim-to-real-adaptation">Sim
            to Real Adaptation</a></li>
      </ul>
    </li>
    <li data-line="13" class="code-line"><a href="#recurrent-state-space-model-rssm"
        data-href="#recurrent-state-space-model-rssm">Recurrent State Space Model (RSSM)</a></li>
    <li data-line="14" class="code-line"><a href="#reinforcement-learning-model-actor-critic--ac"
        data-href="#reinforcement-learning-model-actor-critic--ac">Reinforcement Learning Model (Actor Critic / AC)</a>
    </li>
    <li data-line="15" class="code-line"><a href="#putting-everything-together"
        data-href="#putting-everything-together">Putting Everything Together</a>
      <ul>
        <li data-line="16" class="code-line"><a href="#model-learning" data-href="#model-learning">Model Learning</a>
        </li>
        <li data-line="17" class="code-line"><a href="#agent-learning" data-href="#agent-learning">Agent Learning</a>
        </li>
        <li data-line="18" class="code-line"><a href="#deployment" data-href="#deployment">Deployment</a></li>
        <li data-line="19" class="code-line"><a href="#active-learning" data-href="#active-learning">Active Learning</a>
        </li>
      </ul>
    </li>
  </ul>
  <!-- TOC -->
  <hr>
  <h2 id="prior-setup" data-line="24" class="code-line">Prior Setup</h2>
  <p data-line="25" class="code-line">Several assumptions are needed for this system to work.</p>
  <h3 id="initial-data-collection" data-line="27" class="code-line">Initial Data Collection</h3>
  <p data-line="28" class="code-line">As with any deep learning task, we require data. To obtain this data, ideally, the
    drone is initialy operated by a human operator in the intended environment. The data that is to be collected comes
    from a range of sensors, the most important ones are:</p>
  <ul>
    <li data-line="29" class="code-line">Perceptual cameras
      <ul>
        <li data-line="30" class="code-line">cameras that allow the drone a 3D perception of the world</li>
      </ul>
    </li>
    <li data-line="31" class="code-line">Sensing camera
      <ul>
        <li data-line="32" class="code-line">Camera pointed downward looking at the track/road, used for detecting
          maintenance needs</li>
      </ul>
    </li>
    <li data-line="33" class="code-line">Typical IMU suite</li>
    <li data-line="34" class="code-line">LIDAR or ultrasonic sensors scanning on a horizontal plane
      <ul>
        <li data-line="35" class="code-line">Object proximity detection</li>
      </ul>
    </li>
    <li data-line="36" class="code-line">Throughout the human-piloted flight, collect at every time step:
      <ul>
        <li data-line="37" class="code-line">Perceptual camera footage
          <ul>
            <li data-line="38" class="code-line">
              <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                        <mrow>
                          <mi>X</mi>
                          <mo>=</mo>
                          <mo stretchy="false">{</mo>
                          <msub>
                            <mi>x</mi>
                            <mn>0</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>x</mi>
                            <mn>1</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>x</mi>
                            <mi>T</mi>
                          </msub>
                          <mo stretchy="false">}</mo>
                          <mo>∈</mo>
                          <msup>
                            <mi mathvariant="double-struck">R</mi>
                            <mrow>
                              <msub>
                                <mi>n</mi>
                                <mn>1</mn>
                              </msub>
                              <mo>×</mo>
                              <msub>
                                <mi>n</mi>
                                <mn>2</mn>
                              </msub>
                            </mrow>
                          </msup>
                        </mrow>
                        <annotation encoding="application/x-tex">X = \{x_0, x_1, ..., x_T\} \in \mathbb{R}^{n_1 \times
                          n_2}</annotation>
                      </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                        style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                        style="margin-right:0.07847em;">X</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:1em;vertical-align:-0.25em;"></span><span
                        class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span
                          class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">0</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">1</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span
                        class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span
                        class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                      style="margin-right:0.13889em;">T</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mclose">}</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span
                          class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span
                            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span
                                  style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                                    style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight"><span class="mord mtight"><span
                                          class="mord mathdefault mtight">n</span><span class="msupsub"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.31731428571428577em;"><span
                                                  style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span
                                                    class="pstrut" style="height:2.5em;"></span><span
                                                    class="sizing reset-size3 size1 mtight"><span
                                                      class="mord mtight">1</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.143em;"><span></span></span></span></span></span></span><span
                                        class="mbin mtight">×</span><span class="mord mtight"><span
                                          class="mord mathdefault mtight">n</span><span class="msupsub"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.31731428571428577em;"><span
                                                  style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span
                                                    class="pstrut" style="height:2.5em;"></span><span
                                                    class="sizing reset-size3 size1 mtight"><span
                                                      class="mord mtight">2</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
              </eq>
            </li>
          </ul>
        </li>
        <li data-line="39" class="code-line">Control inputs
          <ul>
            <li data-line="40" class="code-line">
              <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                        <mrow>
                          <mi>A</mi>
                          <mo>=</mo>
                          <mo stretchy="false">{</mo>
                          <msub>
                            <mi>a</mi>
                            <mn>0</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>a</mi>
                            <mn>1</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>a</mi>
                            <mi>T</mi>
                          </msub>
                          <mo stretchy="false">}</mo>
                          <mo>∈</mo>
                          <msup>
                            <mi mathvariant="double-struck">R</mi>
                            <mi>m</mi>
                          </msup>
                        </mrow>
                        <annotation encoding="application/x-tex">A = \{a_0, a_1, ..., a_T\} \in \mathbb{R}^m
                        </annotation>
                      </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                        style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                        class="mrel">=</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                        style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                        class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">0</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">1</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span
                        class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span
                        class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                      style="margin-right:0.13889em;">T</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mclose">}</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span
                          class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span
                            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span
                                  style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                                    style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                      class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span>
              </eq>
            </li>
          </ul>
        </li>
        <li data-line="41" class="code-line">Sensor data (IMU, LIDAR, etc)
          <ul>
            <li data-line="42" class="code-line">
              <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                        <mrow>
                          <mi>Q</mi>
                          <mo>=</mo>
                          <mo stretchy="false">{</mo>
                          <msub>
                            <mi>q</mi>
                            <mn>1</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>q</mi>
                            <mn>2</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>q</mi>
                            <mi>T</mi>
                          </msub>
                          <mo stretchy="false">}</mo>
                          <mo>∈</mo>
                          <msup>
                            <mi mathvariant="double-struck">R</mi>
                            <mi>o</mi>
                          </msup>
                        </mrow>
                        <annotation encoding="application/x-tex">Q = \{q_1, q_2, ..., q_T\} \in \mathbb{R}^o
                        </annotation>
                      </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                        style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span
                        class="mord mathdefault">Q</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:1em;vertical-align:-0.25em;"></span><span
                        class="mopen">{</span><span class="mord"><span class="mord mathdefault"
                          style="margin-right:0.03588em;">q</span><span class="msupsub"><span
                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">1</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span
                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">2</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span
                        class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span
                        class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span
                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.32833099999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                      style="margin-right:0.13889em;">T</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mclose">}</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span
                          class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span
                            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span
                                  style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                                    style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                      class="mord mathdefault mtight">o</span></span></span></span></span></span></span></span></span></span></span>
              </eq>
            </li>
          </ul>
        </li>
        <li data-line="43" class="code-line">Maintenance camera footage
          <ul>
            <li data-line="44" class="code-line">
              <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                        <mrow>
                          <mi>M</mi>
                          <mo>=</mo>
                          <mo stretchy="false">{</mo>
                          <msub>
                            <mi>m</mi>
                            <mn>1</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>m</mi>
                            <mn>2</mn>
                          </msub>
                          <mo separator="true">,</mo>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mi mathvariant="normal">.</mi>
                          <mo separator="true">,</mo>
                          <msub>
                            <mi>m</mi>
                            <mi>T</mi>
                          </msub>
                          <mo stretchy="false">}</mo>
                          <mo>∈</mo>
                          <msup>
                            <mi mathvariant="double-struck">R</mi>
                            <mrow>
                              <msub>
                                <mi>p</mi>
                                <mn>1</mn>
                              </msub>
                              <mo>×</mo>
                              <msub>
                                <mi>p</mi>
                                <mn>2</mn>
                              </msub>
                            </mrow>
                          </msup>
                        </mrow>
                        <annotation encoding="application/x-tex">M = \{m_1, m_2, ..., m_T\} \in \mathbb{R}^{p_1 \times
                          p_2}</annotation>
                      </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                        style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                        style="margin-right:0.10903em;">M</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:1em;vertical-align:-0.25em;"></span><span
                        class="mopen">{</span><span class="mord"><span class="mord mathdefault">m</span><span
                          class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">1</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight">2</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mpunct">,</span><span class="mspace"
                        style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span
                        class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span
                        class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                          class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                              class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                                  style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                    class="pstrut" style="height:2.7em;"></span><span
                                    class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                      style="margin-right:0.13889em;">T</span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                style="height:0.15em;"><span></span></span></span></span></span></span><span
                        class="mclose">}</span><span class="mspace"
                        style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                        class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                        class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span
                          class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span
                            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span
                                  style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                                    style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                      class="mord mtight"><span class="mord mtight"><span
                                          class="mord mathdefault mtight">p</span><span class="msupsub"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.31731428571428577em;"><span
                                                  style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span
                                                    class="pstrut" style="height:2.5em;"></span><span
                                                    class="sizing reset-size3 size1 mtight"><span
                                                      class="mord mtight">1</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.143em;"><span></span></span></span></span></span></span><span
                                        class="mbin mtight">×</span><span class="mord mtight"><span
                                          class="mord mathdefault mtight">p</span><span class="msupsub"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.31731428571428577em;"><span
                                                  style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span
                                                    class="pstrut" style="height:2.5em;"></span><span
                                                    class="sizing reset-size3 size1 mtight"><span
                                                      class="mord mtight">2</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
              </eq>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <h3 id="reward-signal-formulation" data-line="46" class="code-line">Reward Signal formulation</h3>
  <p data-line="47" class="code-line">Because a majority of the system is based on reinforcement learning, there needs
    to be a reward signal. We formulate the reward signal at every time step <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>i</mi>
              </mrow>
              <annotation encoding="application/x-tex">i</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.65952em;vertical-align:0em;"></span><span
              class="mord mathdefault">i</span></span></span></span></eq> according to:</p>
  <section>
    <eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <msub>
                    <mi>r</mi>
                    <mi>i</mi>
                  </msub>
                  <mo>=</mo>
                  <mi>f</mi>
                  <mo stretchy="false">(</mo>
                  <msub>
                    <mover accent="true">
                      <mi>q</mi>
                      <mo>^</mo>
                    </mover>
                    <mrow>
                      <mi>i</mi>
                      <mi>m</mi>
                      <mi>a</mi>
                      <mi>g</mi>
                      <mi>e</mi>
                      <mo separator="true">,</mo>
                      <mi>i</mi>
                    </mrow>
                  </msub>
                  <mo separator="true">,</mo>
                  <msub>
                    <mi>q</mi>
                    <mi>i</mi>
                  </msub>
                  <mo separator="true">,</mo>
                  <mo stretchy="false">)</mo>
                </mrow>
                <annotation encoding="application/x-tex">
                  r_i = f(\hat{q}_{image, i}, q_i, )
                </annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault"
                style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span
                  class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                            style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                              style="margin-right:0.03588em;">q</span></span></span><span style="top:-3em;"><span
                            class="pstrut" style="height:3em;"></span><span class="accent-body"
                            style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                          style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                                class="mord mathdefault mtight">m</span><span
                                class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight"
                                style="margin-right:0.03588em;">g</span><span
                                class="mord mathdefault mtight">e</span><span class="mpunct mtight">,</span><span
                                class="mord mathdefault mtight">i</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.286108em;"><span></span></span></span></span></span></span><span
                class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span
                  class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                class="mclose">)</span></span></span></span></span></eqn>
  </section>
  <p data-line="53" class="code-line">where <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mover accent="true">
                    <mi>q</mi>
                    <mo>^</mo>
                  </mover>
                  <mrow>
                    <mi>i</mi>
                    <mi>m</mi>
                    <mi>a</mi>
                    <mi>g</mi>
                    <mi>e</mi>
                    <mo separator="true">,</mo>
                    <mi>i</mi>
                  </mrow>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">\hat{q}_{image, i}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                          style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                            style="margin-right:0.03588em;">q</span></span></span><span style="top:-3em;"><span
                          class="pstrut" style="height:3em;"></span><span class="accent-body"
                          style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                              class="mord mathdefault mtight">m</span><span
                              class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight"
                              style="margin-right:0.03588em;">g</span><span
                              class="mord mathdefault mtight">e</span><span class="mpunct mtight">,</span><span
                              class="mord mathdefault mtight">i</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>
    </eq> denotes the <a href="#quality-estimator" data-href="#quality-estimator">perceived image quality</a> of the <a
      href="#maintenance-detection-model" data-href="#maintenance-detection-model">maintenance detection model</a>. This
    allows the attainment of a new set of data, known here as the reward signal.</p>
  <ul>
    <li data-line="54" class="code-line">Reward signals
      <ul>
        <li data-line="55" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>R</mi>
                      <mo>=</mo>
                      <mo stretchy="false">{</mo>
                      <msub>
                        <mi>r</mi>
                        <mn>1</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>r</mi>
                        <mn>2</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>r</mi>
                        <mi>T</mi>
                      </msub>
                      <mo stretchy="false">}</mo>
                      <mo>∈</mo>
                      <mi mathvariant="double-struck">R</mi>
                    </mrow>
                    <annotation encoding="application/x-tex">R = \{r_1, r_2, ..., r_T\} \in \mathbb{R}</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.00773em;">R</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">1</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">2</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.32833099999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                  style="margin-right:0.13889em;">T</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                    class="mrel">∈</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span
                      class="mord mathbb">R</span></span></span></span></span></eq>
        </li>
      </ul>
    </li>
  </ul>
  <h3 id="dataset-constructionconsolidation" data-line="57" class="code-line">Dataset Construction/Consolidation</h3>
  <p data-line="58" class="code-line">The training dataset will then consist of the three classical requirements for
    reinforcement learning</p>
  <ul>
    <li data-line="59" class="code-line">State
      <ul>
        <li data-line="60" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>S</mi>
                      <mo>=</mo>
                      <mo stretchy="false">{</mo>
                      <msub>
                        <mi>s</mi>
                        <mn>1</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>s</mi>
                        <mn>2</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>s</mi>
                        <mi>T</mi>
                      </msub>
                      <mo stretchy="false">}</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">S = \{s_1, s_2, ..., s_T\}</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.05764em;">S</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                    class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">1</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">2</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.32833099999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                  style="margin-right:0.13889em;">T</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">}</span></span></span></span></eq>
        </li>
        <li data-line="61" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <msub>
                        <mi>s</mi>
                        <mi>i</mi>
                      </msub>
                      <mo>=</mo>
                      <mo stretchy="false">{</mo>
                      <msub>
                        <mi>x</mi>
                        <mi>i</mi>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>q</mi>
                        <mi>i</mi>
                      </msub>
                      <mo stretchy="false">}</mo>
                      <mi mathvariant="normal">∀</mi>
                      <mi>i</mi>
                      <mo>∈</mo>
                      <mo stretchy="false">[</mo>
                      <mn>1</mn>
                      <mo separator="true">,</mo>
                      <mn>2</mn>
                      <mo separator="true">,</mo>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mo separator="true">,</mo>
                      <mi>T</mi>
                      <mo stretchy="false">]</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">s_i = \{x_i, q_i\} \forall i \in [1, 2, ..., T]
                    </annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span
                      class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                    class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">}</span><span class="mord">∀</span><span class="mord mathdefault">i</span><span
                    class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                    class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                    class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span
                    class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                    style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord mathdefault" style="margin-right:0.13889em;">T</span><span
                    class="mclose">]</span></span></span></span></eq>
        </li>
        <li data-line="62" class="code-line">Optionally keep <eq><span class="katex"><span class="katex-mathml"><math
                  xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>X</mi>
                    </mrow>
                    <annotation encoding="application/x-tex">X</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.07847em;">X</span></span></span></span></eq> a separate variable from <eq>
            <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>S</mi>
                    </mrow>
                    <annotation encoding="application/x-tex">S</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.05764em;">S</span></span></span></span></eq>, explained <a
            href="#recurrent-state-space-model" data-href="#recurrent-state-space-model">later</a></li>
      </ul>
    </li>
    <li data-line="63" class="code-line">Action
      <ul>
        <li data-line="64" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>A</mi>
                      <mo>=</mo>
                      <mo stretchy="false">{</mo>
                      <msub>
                        <mi>a</mi>
                        <mn>0</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>a</mi>
                        <mn>1</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>a</mi>
                        <mi>T</mi>
                      </msub>
                      <mo stretchy="false">}</mo>
                      <mo>∈</mo>
                      <msup>
                        <mi mathvariant="double-struck">R</mi>
                        <mi>m</mi>
                      </msup>
                    </mrow>
                    <annotation encoding="application/x-tex">A = \{a_0, a_1, ..., a_T\} \in \mathbb{R}^m</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span
                    class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                    class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                    class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                    class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">0</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">1</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.32833099999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                  style="margin-right:0.13889em;">T</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                    class="mrel">∈</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span
                        class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span
                          class="vlist-r"><span class="vlist" style="height:0.664392em;"><span
                              style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                                style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span>
          </eq>
        </li>
        <li data-line="65" class="code-line">Nothing special about this, it's the same one as <a
            href="#initial-data-collection" data-href="#initial-data-collection">above</a></li>
      </ul>
    </li>
    <li data-line="66" class="code-line">Reward
      <ul>
        <li data-line="67" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>R</mi>
                      <mo>=</mo>
                      <mo stretchy="false">{</mo>
                      <msub>
                        <mi>r</mi>
                        <mn>1</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>r</mi>
                        <mn>2</mn>
                      </msub>
                      <mo separator="true">,</mo>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mi mathvariant="normal">.</mi>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>r</mi>
                        <mi>T</mi>
                      </msub>
                      <mo stretchy="false">}</mo>
                      <mo>∈</mo>
                      <mi mathvariant="double-struck">R</mi>
                    </mrow>
                    <annotation encoding="application/x-tex">R = \{r_1, r_2, ..., r_T\} \in \mathbb{R}</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.00773em;">R</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">1</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.30110799999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mtight">2</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.32833099999999993em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                                  style="margin-right:0.13889em;">T</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                    class="mrel">∈</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span
                      class="mord mathbb">R</span></span></span></span></span></eq>
        </li>
        <li data-line="68" class="code-line">Again, nothing special here, same as <a href="#reward-signal-formulation"
            data-href="#reward-signal-formulation">above</a></li>
      </ul>
    </li>
  </ul>
  <hr>
  <h2 id="maintenance-detection-model" data-line="72" class="code-line">Maintenance Detection Model</h2>
  <p data-line="73" class="code-line">There are two core purposes of the computer vision model. The first is to predict
    any and all <a href="#maintenance-requirements" data-href="#maintenance-requirements">maintenance requirements</a>,
    as part of the task at hand. The second is to provide part of the <a href="#reward-signal-formulation"
      data-href="#reward-signal-formulation">reward signal</a> to the performance of the flight in the form of a <a
      href="#quality-estimator" data-href="#quality-estimator">quality estimate</a>. The core architecture of the
    maintenance detection model should then resemble the following model:</p>
  <p data-line="75" class="code-line"><img src="Maintenance%20Model.png" alt="Maintenance Model" class="loading"
      id="image-hash--760483669"></p>
  <blockquote data-line="77" class="code-line">
    <p data-line="77" class="code-line">Correction: In the above image, the outputs from the network are flipped;
      detections should be above, and <eq><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mover accent="true">
                    <mi>q</mi>
                    <mo>^</mo>
                  </mover>
                </mrow>
                <annotation encoding="application/x-tex">\hat{q}</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord accent"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span
                        style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span
                            class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span><span
                        style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body"
                          style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.19444em;"><span></span></span></span></span></span></span></span></span></eq>
      should be below.</p>
  </blockquote>
  <h3 id="maintenance-requirements" data-line="79" class="code-line">Maintenance Requirements</h3>
  <p data-line="80" class="code-line">Some of the maintenance requirements taken from literature include the following:
  </p>
  <ul>
    <li data-line="81" class="code-line"><strong>Railway</strong>
      <ul>
        <li data-line="82" class="code-line">Missing fasteners</li>
        <li data-line="83" class="code-line">Cracked sleepers</li>
        <li data-line="84" class="code-line">Switch inspection</li>
        <li data-line="85" class="code-line">Things that are difficult to detect
          <ul>
            <li data-line="86" class="code-line">Track twist</li>
            <li data-line="87" class="code-line">Spring nest displacement</li>
            <li data-line="88" class="code-line">Rail longitudinal/lateral deflection from normal</li>
          </ul>
        </li>
      </ul>
    </li>
    <li data-line="89" class="code-line"><strong>Road</strong>
      <ul>
        <li data-line="90" class="code-line">Cracks
          <ul>
            <li data-line="91" class="code-line">Alligator cracks</li>
            <li data-line="92" class="code-line">Block cracking</li>
            <li data-line="93" class="code-line">Longitudinal/lateral cracking</li>
            <li data-line="94" class="code-line">Reflection cracking</li>
          </ul>
        </li>
        <li data-line="95" class="code-line">Rutting</li>
        <li data-line="96" class="code-line">Potholes</li>
        <li data-line="97" class="code-line">Other debris</li>
      </ul>
    </li>
  </ul>
  <blockquote data-line="99" class="code-line">
    <p data-line="99" class="code-line">Classically, detection of maintenance on rails requires laser scanners for rail
      deflection. Road maintenance tools classically include lidar, ultrasonic measurement, and IR measurements. For
      this reason, the maintenance issues are generally limited to a subset of existing maintenance issues because a
      more sophisticated suite of sensors are needed (this restriction is mostly in the rail, in addition, using these
      sensors on a flying drone is virtually impossible because they measure defects in the order of 1-10 mm, the height
      deviation from mere hovering will demolish this precision).</p>
  </blockquote>
  <h3 id="detection-model" data-line="101" class="code-line">Detection Model</h3>
  <p data-line="102" class="code-line">The detection model should not be hard to develop, seeing as computer vision with
    a given dataset is, in this day and age, a trivial task to solve.</p>
  <p data-line="104" class="code-line">Some good brush-up papers are:</p>
  <ul>
    <li data-line="105" class="code-line"><a
        href="https://ieeexplore.ieee.org/abstract/document/8627998/?casa_token=cYO3ecdowBoAAAAA:NrqIoOjyfDbZyeBp5cTnIx4jBeHSsbfZ3KrFESme3p82scQOOINHqVc4ATvJnrssrHNT8s2q5sU"
        data-href="https://ieeexplore.ieee.org/abstract/document/8627998/?casa_token=cYO3ecdowBoAAAAA:NrqIoOjyfDbZyeBp5cTnIx4jBeHSsbfZ3KrFESme3p82scQOOINHqVc4ATvJnrssrHNT8s2q5sU">Object
        Detection with Deep Learning, A Review</a></li>
    <li data-line="106" class="code-line"><a href="https://arxiv.org/abs/2001.05566"
        data-href="https://arxiv.org/abs/2001.05566">Image Segmentation with Deep Learning, A Survey</a></li>
    <li data-line="107" class="code-line"><a href="https://arxiv.org/abs/2012.07968"
        data-href="https://arxiv.org/abs/2012.07968">FasteNet, my paper</a></li>
  </ul>
  <p data-line="109" class="code-line">This part of the system should not be a concern.</p>
  <h3 id="quality-estimator" data-line="111" class="code-line">Quality Estimator</h3>
  <p data-line="112" class="code-line">When performing detection/segmentation on the images, it is not possible for all
    the images to be well represented in the training dataset. To detect less-than-ideal images during deployment, we
    append an auxialliary branch to the computer vision model that predicts a quality metric, <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mover accent="true">
                    <mi>q</mi>
                    <mo>^</mo>
                  </mover>
                  <mrow>
                    <mi>i</mi>
                    <mi>m</mi>
                    <mi>a</mi>
                    <mi>g</mi>
                    <mi>e</mi>
                  </mrow>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">\hat{q}_{image}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                          style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                            style="margin-right:0.03588em;">q</span></span></span><span style="top:-3em;"><span
                          class="pstrut" style="height:3em;"></span><span class="accent-body"
                          style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                              class="mord mathdefault mtight">m</span><span
                              class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight"
                              style="margin-right:0.03588em;">g</span><span
                              class="mord mathdefault mtight">e</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>
    </eq>.</p>
  <p data-line="114" class="code-line">Training this branch is easy: after the main branch of the model is trained, we
    add less-than-ideal images to the base image dataset <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>M</mi>
              </mrow>
              <annotation encoding="application/x-tex">M</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.10903em;">M</span></span></span></span></eq> and freeze the detection branch. Then,
    make the auxilliary branch predict the error in detection between the ideal case and the non-ideal case.</p>
  <hr>
  <h2 id="state-encoder-se" data-line="118" class="code-line">State Encoder (SE)</h2>
  <p data-line="119" class="code-line">When performing conventional path planning on drones, typically, the flow of
    information can be represented by the following model:</p>
  <p data-line="121" class="code-line"><img src="State%20Estimation%20and%20Control.png"
      alt="Conventional Estimation and Control" class="loading" id="image-hash-793963759"></p>
  <p data-line="123" class="code-line">This presents several challenges in design:</p>
  <ul>
    <li data-line="124" class="code-line">How do we represent the state of the the entire system? Global position,
      obstacles, world features, track position, etc...</li>
    <li data-line="125" class="code-line">What's important for a good flight path? If the core computer vision model is
      regarded as a data-driven process, inherently there is no metric or heuristic that can be optimized upon to get a
      good flight path.</li>
    <li data-line="126" class="code-line">What sensors are necessary, and how many of them do we need at what precision?
    </li>
  </ul>
  <p data-line="128" class="code-line">Admittedly, while an architecture where everything is deterministic and has an
    explicit formulation is possible, it is not entirely scalable from one scenario to the next. In addition, the phd
    title has 'AI-enabled drones' in it, may as well take that notion to the extreme...</p>
  <p data-line="130" class="code-line">The core idea of the state encoder is to allow the drone to represent the system
    state, <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>s</mi>
                <mo>∈</mo>
                <mi>S</mi>
              </mrow>
              <annotation encoding="application/x-tex">s \in S</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">s</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.05764em;">S</span></span></span></span></eq> in the form of a hidden latent
    variable, <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>z</mi>
                <mo>∈</mo>
                <mi>Z</mi>
                <mo>∼</mo>
                <msub>
                  <mi>p</mi>
                  <mrow>
                    <mi>e</mi>
                    <mo separator="true">,</mo>
                    <mi>θ</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">(</mo>
                <mi>z</mi>
                <mi mathvariant="normal">∣</mi>
                <mi>s</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">z \in Z \sim p_{e, \theta}(z|s)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault"
              style="margin-right:0.04398em;">z</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">Z</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">e</span><span
                              class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
              class="mord">∣</span><span class="mord mathdefault">s</span><span
              class="mclose">)</span></span></span></span></eq>. Hidden here implies that the meaning of this variable
    is non-human-interpretable. Note that this is a stochastic distribution. We denote with the vector <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>θ</mi>
              </mrow>
              <annotation encoding="application/x-tex">\theta</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.02778em;">θ</span></span></span></span></eq> distributions that are parameterized by
    a neural network.</p>
  <p data-line="132" class="code-line">The purpose of this is to reduce the very high-dimensional state information <eq>
      <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>s</mi>
                <mo>∈</mo>
                <mi>S</mi>
              </mrow>
              <annotation encoding="application/x-tex">s \in S</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">s</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.05764em;">S</span></span></span></span></eq> into a much lower dimensional latent
    space <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>z</mi>
                <mo>∈</mo>
                <mi>Z</mi>
              </mrow>
              <annotation encoding="application/x-tex">z \in Z</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault"
              style="margin-right:0.04398em;">z</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">Z</span></span></span></span></eq>, where <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>dim</mi>
                <mo>⁡</mo>
                <mo stretchy="false">(</mo>
                <mi>s</mi>
                <mo stretchy="false">)</mo>
                <mo>≈</mo>
                <mn>10</mn>
                <mi>e</mi>
                <mn>6</mn>
              </mrow>
              <annotation encoding="application/x-tex">\dim(s) \approx 10e6</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mop">dim</span><span
              class="mopen">(</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span
              class="mord">0</span><span class="mord mathdefault">e</span><span
              class="mord">6</span></span></span></span></eq> and <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>dim</mi>
                <mo>⁡</mo>
                <mo stretchy="false">(</mo>
                <mi>z</mi>
                <mo stretchy="false">)</mo>
                <mo>≈</mo>
                <mn>10</mn>
                <mi>e</mi>
                <mn>2</mn>
              </mrow>
              <annotation encoding="application/x-tex">\dim(z) \approx 10e2</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mop">dim</span><span
              class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
              class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
              class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
            class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span
              class="mord">1</span><span class="mord">0</span><span class="mord mathdefault">e</span><span
              class="mord">2</span></span></span></span></eq>. This is necessary because current reinforcement learning
    algorithms do not function well with very high dimensional data, so this reduction of data dimension is necessary.
    In the <a href="#putting-everything-together" data-href="#putting-everything-together">future</a>, we also see that
    this allows a dramatic speed-up in training by allowing the neural network to perform training in many more batches
    than when training with raw states <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>s</mi>
              </mrow>
              <annotation encoding="application/x-tex">s</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.43056em;vertical-align:0em;"></span><span
              class="mord mathdefault">s</span></span></span></span></eq>.</p>
  <p data-line="134" class="code-line">To achieve this meaningful encoding of the system state, a modified <a
      href="https://arxiv.org/abs/1312.6114" data-href="https://arxiv.org/abs/1312.6114">variational auto encoder</a>
    can be used. The paper in the link is rather dated, but should give a good representation of what is planned to be
    achieved. In short, we represent the latent variable according to <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>z</mi>
                <mo>∈</mo>
                <mi>Z</mi>
                <mo>∼</mo>
                <msub>
                  <mi>p</mi>
                  <mrow>
                    <mi>e</mi>
                    <mo separator="true">,</mo>
                    <mi>θ</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">(</mo>
                <mi>z</mi>
                <mi mathvariant="normal">∣</mi>
                <mi>s</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">z \in Z \sim p_{e, \theta}(z|s)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault"
              style="margin-right:0.04398em;">z</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">Z</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">e</span><span
                              class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
              class="mord">∣</span><span class="mord mathdefault">s</span><span
              class="mclose">)</span></span></span></span></eq>, and then have another distribution reproduce <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mover accent="true">
                  <mi>s</mi>
                  <mo>^</mo>
                </mover>
                <mo>∈</mo>
                <mover accent="true">
                  <mi>S</mi>
                  <mo>^</mo>
                </mover>
                <mo>∼</mo>
                <msub>
                  <mi>p</mi>
                  <mrow>
                    <mi>d</mi>
                    <mo separator="true">,</mo>
                    <mi>θ</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">(</mo>
                <mover accent="true">
                  <mi>s</mi>
                  <mo>^</mo>
                </mover>
                <mi mathvariant="normal">∣</mi>
                <mi>z</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">\hat{s} \in \hat{S} \sim p_{d, \theta}(\hat{s}|z)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord accent"><span
                class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span
                      style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span
                          class="mord mathdefault">s</span></span></span><span style="top:-3em;"><span class="pstrut"
                        style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span
                          class="mord">^</span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.9467699999999999em;vertical-align:0em;"></span><span class="mord accent"><span
                class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span
                      style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span
                          class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span><span
                      style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body"
                        style="left:-0.16666em;"><span
                          class="mord">^</span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">d</span><span
                              class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span
                    class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                        style="height:3em;"></span><span class="mord"><span
                          class="mord mathdefault">s</span></span></span><span style="top:-3em;"><span class="pstrut"
                        style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span
                          class="mord">^</span></span></span></span></span></span></span><span
              class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
              class="mclose">)</span></span></span></span></eq>. We then regress <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mover accent="true">
                  <mi>s</mi>
                  <mo>^</mo>
                </mover>
              </mrow>
              <annotation encoding="application/x-tex">\hat{s}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.69444em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span
                  class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span
                        class="pstrut" style="height:3em;"></span><span class="mord"><span
                          class="mord mathdefault">s</span></span></span><span style="top:-3em;"><span class="pstrut"
                        style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span
                          class="mord">^</span></span></span></span></span></span></span></span></span></span></eq> onto
    <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>s</mi>
              </mrow>
              <annotation encoding="application/x-tex">s</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.43056em;vertical-align:0em;"></span><span
              class="mord mathdefault">s</span></span></span></span></eq> through standard back propogation. To enforce
    closeness in the space of <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>Z</mi>
              </mrow>
              <annotation encoding="application/x-tex">Z</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">Z</span></span></span></span></eq> (to prevent overfitting), an additional
    distribution loss of <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>L</mi>
                  <mrow>
                    <mi>K</mi>
                    <mi>L</mi>
                  </mrow>
                </msub>
                <mo>=</mo>
                <mi>K</mi>
                <mi>L</mi>
                <mo stretchy="false">(</mo>
                <mi>p</mi>
                <mo stretchy="false">(</mo>
                <mi>Z</mi>
                <mo stretchy="false">)</mo>
                <mi mathvariant="normal">∣</mi>
                <mi mathvariant="normal">∣</mi>
                <mi>p</mi>
                <mo stretchy="false">(</mo>
                <mover accent="true">
                  <mi>Z</mi>
                  <mo>ˉ</mo>
                </mover>
                <mo stretchy="false">)</mo>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">L_{KL} = KL(p(Z)||p(\bar{Z}))</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight"
                              style="margin-right:0.07153em;">K</span><span
                              class="mord mathdefault mtight">L</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1.07011em;vertical-align:-0.25em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span><span
              class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span
              class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span><span
              class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault">p</span><span
              class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span
                    class="vlist" style="height:0.8201099999999999em;"><span style="top:-3em;"><span class="pstrut"
                        style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                          style="margin-right:0.07153em;">Z</span></span></span><span style="top:-3.25233em;"><span
                        class="pstrut" style="height:3em;"></span><span class="accent-body"
                        style="left:-0.16666em;"><span
                          class="mord">ˉ</span></span></span></span></span></span></span><span
              class="mclose">)</span><span class="mclose">)</span></span></span></span></eq> can be added, where <eq>
      <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mover accent="true">
                  <mi>Z</mi>
                  <mo>ˉ</mo>
                </mover>
              </mrow>
              <annotation encoding="application/x-tex">\bar{Z}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.8201099999999999em;vertical-align:0em;"></span><span class="mord accent"><span
                class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8201099999999999em;"><span
                      style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span
                          class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span
                      style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body"
                        style="left:-0.16666em;"><span
                          class="mord">ˉ</span></span></span></span></span></span></span></span></span></span></eq> is
    some prior, predefined distribution, usually chosen as a Gaussian ball with unit variance. The <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>K</mi>
                <mi>L</mi>
              </mrow>
              <annotation encoding="application/x-tex">KL</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
              style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span></eq>
    term simply denotes the Kullback-Leibler divergence, which is a measure of distances between distributions. The
    formulation classically used is:</p>
  <section>
    <eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <msub>
                    <mi>L</mi>
                    <mrow>
                      <mi>K</mi>
                      <mi>L</mi>
                    </mrow>
                  </msub>
                  <mo>=</mo>
                  <mi>K</mi>
                  <mi>L</mi>
                  <mo stretchy="false">(</mo>
                  <mi>p</mi>
                  <mo stretchy="false">(</mo>
                  <mi>Z</mi>
                  <mo stretchy="false">)</mo>
                  <mi mathvariant="normal">∣</mi>
                  <mi mathvariant="normal">∣</mi>
                  <mi>p</mi>
                  <mo stretchy="false">(</mo>
                  <mover accent="true">
                    <mi>Z</mi>
                    <mo>ˉ</mo>
                  </mover>
                  <mo stretchy="false">)</mo>
                  <mo stretchy="false">)</mo>
                  <mspace linebreak="newline"></mspace>
                  <msub>
                    <mi>L</mi>
                    <mrow>
                      <mi>K</mi>
                      <mi>L</mi>
                    </mrow>
                  </msub>
                  <mo>=</mo>
                  <msub>
                    <mi mathvariant="double-struck">E</mi>
                    <mi>Z</mi>
                  </msub>
                  <mo stretchy="false">[</mo>
                  <mi>l</mi>
                  <mi>o</mi>
                  <mi>g</mi>
                  <mo stretchy="false">(</mo>
                  <mfrac>
                    <mrow>
                      <msub>
                        <mi>p</mi>
                        <mrow>
                          <mi>e</mi>
                          <mo separator="true">,</mo>
                          <mi>θ</mi>
                        </mrow>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <mi>z</mi>
                      <mi mathvariant="normal">∣</mi>
                      <mi>s</mi>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <mrow>
                      <mi>p</mi>
                      <mo stretchy="false">(</mo>
                      <mover accent="true">
                        <mi>z</mi>
                        <mo>ˉ</mo>
                      </mover>
                      <mo stretchy="false">)</mo>
                    </mrow>
                  </mfrac>
                  <mo stretchy="false">)</mo>
                  <mo stretchy="false">]</mo>
                  <mspace linebreak="newline"></mspace>
                  <msub>
                    <mi>L</mi>
                    <mrow>
                      <mi>K</mi>
                      <mi>L</mi>
                    </mrow>
                  </msub>
                  <mo>=</mo>
                  <mfrac>
                    <mn>1</mn>
                    <mi>T</mi>
                  </mfrac>
                  <munderover>
                    <mo>∑</mo>
                    <mi>i</mi>
                    <mi>T</mi>
                  </munderover>
                  <mo stretchy="false">[</mo>
                  <mi>l</mi>
                  <mi>o</mi>
                  <mi>g</mi>
                  <mo stretchy="false">(</mo>
                  <msub>
                    <mi>p</mi>
                    <mrow>
                      <mi>e</mi>
                      <mo separator="true">,</mo>
                      <mi>θ</mi>
                    </mrow>
                  </msub>
                  <mo stretchy="false">(</mo>
                  <msub>
                    <mi>z</mi>
                    <mi>i</mi>
                  </msub>
                  <mi mathvariant="normal">∣</mi>
                  <mi>s</mi>
                  <mo stretchy="false">)</mo>
                  <mo stretchy="false">)</mo>
                  <mo>−</mo>
                  <mi>l</mi>
                  <mi>o</mi>
                  <mi>g</mi>
                  <mo stretchy="false">(</mo>
                  <mi>p</mi>
                  <mo stretchy="false">(</mo>
                  <msub>
                    <mover accent="true">
                      <mi>z</mi>
                      <mo>ˉ</mo>
                    </mover>
                    <mi>i</mi>
                  </msub>
                  <mo stretchy="false">)</mo>
                  <mo stretchy="false">)</mo>
                  <mo stretchy="false">]</mo>
                </mrow>
                <annotation encoding="application/x-tex">
                  L_{KL} = KL(p(Z)||p(\bar{Z})) \\
                  L_{KL} = \mathbb{E}_Z [log(\frac{p_{e, \theta}(z|s)}{p(\bar{z})})] \\
                  L_{KL} = \frac{1}{T}\sum_i^T[log(p_{e, \theta}(z_i|s)) - log(p(\bar{z}_i))]
                </annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                          style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight"
                                style="margin-right:0.07153em;">K</span><span
                                class="mord mathdefault mtight">L</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:1.07011em;vertical-align:-0.25em;"></span><span class="mord mathdefault"
                style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span><span
                class="mopen">(</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span
                class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span><span
                class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault">p</span><span
                class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span
                      class="vlist" style="height:0.8201099999999999em;"><span style="top:-3em;"><span class="pstrut"
                          style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                            style="margin-right:0.07153em;">Z</span></span></span><span style="top:-3.25233em;"><span
                          class="pstrut" style="height:3em;"></span><span class="accent-body"
                          style="left:-0.16666em;"><span
                            class="mord">ˉ</span></span></span></span></span></span></span><span
                class="mclose">)</span><span class="mclose">)</span></span><span class="mspace newline"></span><span
              class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span
                class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.32833099999999993em;"><span
                          style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight"
                                style="margin-right:0.07153em;">K</span><span
                                class="mord mathdefault mtight">L</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mord"><span
                    class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                          style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight"
                              style="margin-right:0.07153em;">Z</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span
                class="mord mathdefault">o</span><span class="mord mathdefault"
                style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span
                  class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span
                            class="pstrut" style="height:3em;"></span><span class="mord"><span
                              class="mord mathdefault">p</span><span class="mopen">(</span><span
                              class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                                    style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut"
                                        style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                                          style="margin-right:0.04398em;">z</span></span></span><span
                                      style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                        class="accent-body" style="left:-0.19444em;"><span
                                          class="mord">ˉ</span></span></span></span></span></span></span><span
                              class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut"
                            style="height:3em;"></span><span class="frac-line"
                            style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span
                            class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span
                                class="mord mathdefault">p</span><span class="msupsub"><span
                                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                      style="height:0.3361079999999999em;"><span
                                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                          class="pstrut" style="height:2.7em;"></span><span
                                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                              class="mord mathdefault mtight">e</span><span
                                              class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                                              style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
                              class="mopen">(</span><span class="mord mathdefault"
                              style="margin-right:0.04398em;">z</span><span class="mord">∣</span><span
                              class="mord mathdefault">s</span><span class="mclose">)</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.936em;"><span></span></span></span></span></span><span
                  class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span
                class="mclose">]</span></span><span class="mspace newline"></span><span class="base"><span class="strut"
                style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span
                          style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight"
                                style="margin-right:0.07153em;">K</span><span
                                class="mord mathdefault mtight">L</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord"><span
                  class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span
                            class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                              style="margin-right:0.13889em;">T</span></span></span><span style="top:-3.23em;"><span
                            class="pstrut" style="height:3em;"></span><span class="frac-line"
                            style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span
                            class="pstrut" style="height:3em;"></span><span class="mord"><span
                              class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span
                      class="vlist-r"><span class="vlist"
                        style="height:0.686em;"><span></span></span></span></span></span><span
                  class="mclose nulldelimiter"></span></span><span class="mspace"
                style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span
                          class="pstrut" style="height:3.05em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span><span style="top:-3.050005em;"><span
                          class="pstrut" style="height:3.05em;"></span><span><span
                            class="mop op-symbol large-op">∑</span></span></span><span
                        style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut"
                          style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight"
                            style="margin-right:0.13889em;">T</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:1.277669em;"><span></span></span></span></span></span><span
                class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span
                class="mord mathdefault">o</span><span class="mord mathdefault"
                style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span
                  class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                          style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight">e</span><span
                                class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                                style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.286108em;"><span></span></span></span></span></span></span><span
                class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                  style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mord">∣</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span
                class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span
                class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span
              class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span
                class="mord mathdefault" style="margin-right:0.01968em;">l</span><span
                class="mord mathdefault">o</span><span class="mord mathdefault"
                style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span
                class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span
                  class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                        style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut"
                            style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                              style="margin-right:0.04398em;">z</span></span></span><span style="top:-3em;"><span
                            class="pstrut" style="height:3em;"></span><span class="accent-body"
                            style="left:-0.19444em;"><span
                              class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mclose">)</span><span class="mclose">)</span><span
                class="mclose">]</span></span></span></span></span></eqn>
  </section>
  <blockquote data-line="142" class="code-line">
    <p data-line="142" class="code-line">Note that the distribution of <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span></span></span></span></eq> is stochastic, that is, the neural
      network outputs a distribution, and then the latent variable <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span></span></span></span></eq> is sampled from this distribution via
      the <a href="https://arxiv.org/abs/1312.6114" data-href="https://arxiv.org/abs/1312.6114">reparameterization
        trick</a>. It is therefore convenient to represent the distributions as simple Gaussians.</p>
  </blockquote>
  <p data-line="144" class="code-line">As can be seen, simply summing all the data at a sufficient scale is enough to
    enforce this constraint. Unfortunately, doing this can be disadvantageous by forcing the network to place all the
    state representations very closely within the latent space, potentially losing out on representational capacity. To
    circumvent this, I propose that we simply replace <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mover accent="true">
                  <mi>z</mi>
                  <mo>ˉ</mo>
                </mover>
                <mo>=</mo>
                <msub>
                  <mi>z</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">\bar{z} = z_{i-1}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.56778em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span
                  class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span
                        class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                          style="margin-right:0.04398em;">z</span></span></span><span style="top:-3em;"><span
                        class="pstrut" style="height:3em;"></span><span class="accent-body"
                        style="left:-0.19444em;"><span
                          class="mord">ˉ</span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>
    </eq> (some notation change in the expectation is needed, but this is fairly trivial to do and the end result is the
    same). The intuition is that this enforces adjacent states <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>s</mi>
              </mrow>
              <annotation encoding="application/x-tex">s</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.43056em;vertical-align:0em;"></span><span
              class="mord mathdefault">s</span></span></span></span></eq> (which are by definition very close to each
    other being only one time step away from each other) to be represented closely in latent space, but states that are
    very far away (for example <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>s</mi>
                  <mn>3</mn>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">s_3</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span
                    class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>
    and <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>s</mi>
                  <mn>100</mn>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">s_{100}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mtight">1</span><span
                              class="mord mtight">0</span><span
                              class="mord mtight">0</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>)
    can be placed very far apart in latent space. By intuition, in the limit, all the latent space variables will
    eventually be a coherent mass, but this still requires mathematical proof.</p>
  <blockquote data-line="146" class="code-line">
    <p data-line="146" class="code-line">Optionally, to enforce a <em>meaningful</em> representation of the state <eq>
        <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>s</mi>
                </mrow>
                <annotation encoding="application/x-tex">s</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span
                class="mord mathdefault">s</span></span></span></span></eq> in <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span></span></span></span></eq>, we can train the SE to output
      segmentation masks generated by an off-the-shelf semantic segmentation model. This way, things like tree colour,
      sky colour, etc, are not represented in the latent variable <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span></span></span></span></eq>.</p>
  </blockquote>
  <h3 id="sim-to-real-adaptation" data-line="148" class="code-line">Sim to Real Adaptation</h3>
  <pre><code data-line="149" class="code-line"><code><div>This section is inspired and well brought up by Dr. Mauro.
</div></code></code></pre>
  <p data-line="152" class="code-line">The idea of learning from simulation before application to the real world is
    actually not a totally new concept, albeit it can be a relatively hard one. The core concept is that humans can
    learn from simulation, so why not neural networks?</p>
  <p data-line="154" class="code-line">One solution to this problem is using a Cycle-GAN to perform domain adaptation.
    Given system states from a target domain characterized by <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>t</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo>∈</mo>
                <msub>
                  <mi>M</mi>
                  <mi>t</mi>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">S^{(t)} \in M_t</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.9270999999999999em;vertical-align:-0.0391em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">t</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.2805559999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">t</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>
    where <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>M</mi>
                  <mi>t</mi>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">M_t</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">t</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>
    described a target domain (the real world), and system states from the source domain characterized by <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo>∈</mo>
                <msub>
                  <mi>M</mi>
                  <mi>s</mi>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">S^{(s)} \in M_s</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.9270999999999999em;vertical-align:-0.0391em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">s</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">s</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>,
    we design a <a href="https://arxiv.org/abs/1703.10593" data-href="https://arxiv.org/abs/1703.10593">Cycle-GAN</a>
    that first performs an image transformation <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>f</mi>
                  <mrow>
                    <mi>s</mi>
                    <mn>2</mn>
                    <mi>r</mi>
                  </mrow>
                </msub>
                <mo>:</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo>→</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>r</mi>
                    <mo stretchy="false">)</mo>
                    <mo>∗</mo>
                  </mrow>
                </msup>
              </mrow>
              <annotation encoding="application/x-tex">f_{s2r} : S^{(s)} \rightarrow S^{(r)*}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.30110799999999993em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight">s</span><span class="mord mtight">2</span><span
                              class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">s</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span><span class="mclose mtight">)</span><span
                              class="mord mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>
    </eq> and another Cycle-GAN that reverses the transformation <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>f</mi>
                  <mrow>
                    <mi>r</mi>
                    <mn>2</mn>
                    <mi>s</mi>
                  </mrow>
                </msub>
                <mo>:</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>r</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo>→</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                    <mo>∗</mo>
                  </mrow>
                </msup>
              </mrow>
              <annotation encoding="application/x-tex">f_{r2s} : S^{(r)} \rightarrow S^{(s)*}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.30110799999999993em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span
                              class="mord mtight">2</span><span
                              class="mord mathdefault mtight">s</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span><span
                              class="mord mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>
    </eq>.</p>
  <blockquote data-line="156" class="code-line">
    <p data-line="156" class="code-line">Note that s2r means sim2real, while r2s means real2sim. In addition, states
      with a single superscript <eq><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mo>∗</mo>
                </mrow>
                <annotation encoding="application/x-tex">*</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.46528em;vertical-align:0em;"></span><span class="mord">∗</span></span></span></span>
      </eq> denote states after one transformation, and those with two <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mo>∗</mo>
                  <mo>∗</mo>
                </mrow>
                <annotation encoding="application/x-tex">**</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.46528em;vertical-align:0em;"></span><span class="mord">∗</span><span
                class="mord">∗</span></span></span></span></eq> denote states after two transformations. A
      transformation <eq><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mo>∗</mo>
                </mrow>
                <annotation encoding="application/x-tex">*</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.46528em;vertical-align:0em;"></span><span class="mord">∗</span></span></span></span>
      </eq> has to be from the opposing domain, and not from the same domain. Simply put, the inverse of a specific
      transformation <eq><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <msubsup>
                    <mi>f</mi>
                    <mrow>
                      <mi>r</mi>
                      <mn>2</mn>
                      <mi>s</mi>
                    </mrow>
                    <mrow>
                      <mo>−</mo>
                      <mn>1</mn>
                    </mrow>
                  </msubsup>
                  <mo>:</mo>
                  <msup>
                    <mi>S</mi>
                    <mrow>
                      <mo stretchy="false">(</mo>
                      <mi>r</mi>
                      <mo stretchy="false">)</mo>
                      <mo>∗</mo>
                    </mrow>
                  </msup>
                  <mo>→</mo>
                  <msup>
                    <mi>S</mi>
                    <mrow>
                      <mo stretchy="false">(</mo>
                      <mi>s</mi>
                      <mo stretchy="false">)</mo>
                    </mrow>
                  </msup>
                </mrow>
                <annotation encoding="application/x-tex">f^{-1}_{r2s} : S^{(r)*} \rightarrow S^{(s)}</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:1.120547em;vertical-align:-0.266308em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854239em;"><span
                          style="top:-2.433692em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight"
                                style="margin-right:0.02778em;">r</span><span class="mord mtight">2</span><span
                                class="mord mathdefault mtight">s</span></span></span></span><span
                          style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mtight">−</span><span
                                class="mord mtight">1</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                    class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                          style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mopen mtight">(</span><span
                                class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span
                                class="mclose mtight">)</span><span
                                class="mord mtight">∗</span></span></span></span></span></span></span></span></span><span
                class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span
                class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span
                    class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                          style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mopen mtight">(</span><span
                                class="mord mathdefault mtight">s</span><span
                                class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>
      </eq> must map from either <eq><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mo stretchy="false">(</mo>
                  <mi>s</mi>
                  <mo stretchy="false">)</mo>
                </mrow>
                <annotation encoding="application/x-tex">(s)</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span
                class="mord mathdefault">s</span><span class="mclose">)</span></span></span></span></eq> to <eq><span
          class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mo stretchy="false">(</mo>
                  <mi>r</mi>
                  <mo stretchy="false">)</mo>
                </mrow>
                <annotation encoding="application/x-tex">(r)</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span
                class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                class="mclose">)</span></span></span></span></eq> or vice versa.</p>
  </blockquote>
  <p data-line="158" class="code-line">After that is done, we simply optimize for the cycle loss <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>L</mi>
                  <mrow>
                    <mi>c</mi>
                    <mi>y</mi>
                    <mi>c</mi>
                    <mi>l</mi>
                    <mi>e</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">(</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>r</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo separator="true">,</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>r</mi>
                    <mo stretchy="false">)</mo>
                    <mo>∗</mo>
                    <mo>∗</mo>
                  </mrow>
                </msup>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">L_{cycle}(S^{(r)}, S^{(r)**})</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1.174108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">c</span><span
                              class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span
                              class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight"
                              style="margin-right:0.01968em;">l</span><span
                              class="mord mathdefault mtight">e</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span
                    class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span
                class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                      style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mopen mtight">(</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span><span class="mclose mtight">)</span><span
                              class="mbin mtight">∗</span><span
                              class="mord mtight">∗</span></span></span></span></span></span></span></span></span><span
              class="mclose">)</span></span></span></span></eq> and <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>L</mi>
                  <mrow>
                    <mi>c</mi>
                    <mi>y</mi>
                    <mi>c</mi>
                    <mi>l</mi>
                    <mi>e</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">(</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
                <mo separator="true">,</mo>
                <msup>
                  <mi>S</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                    <mo>∗</mo>
                    <mo>∗</mo>
                  </mrow>
                </msup>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">L_{cycle}(S^{(s)}, S^{(s)**})</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1.174108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">c</span><span
                              class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span
                              class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight"
                              style="margin-right:0.01968em;">l</span><span
                              class="mord mathdefault mtight">e</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.286108em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span
                    class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">s</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span
                class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                      style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mopen mtight">(</span><span class="mord mathdefault mtight">s</span><span
                              class="mclose mtight">)</span><span class="mbin mtight">∗</span><span
                              class="mord mtight">∗</span></span></span></span></span></span></span></span></span><span
              class="mclose">)</span></span></span></span></eq>. In addition, we can enforce that the compressed state
    representations taken from both sim and real representations <eq><span class="katex"><span
          class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msup>
                  <mi>z</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>r</mi>
                    <mo stretchy="false">)</mo>
                  </mrow>
                </msup>
              </mrow>
              <annotation encoding="application/x-tex">z^{(r)}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">r</span><span
                              class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>
    </eq> and <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msup>
                  <mi>z</mi>
                  <mrow>
                    <mo stretchy="false">(</mo>
                    <mi>s</mi>
                    <mo stretchy="false">)</mo>
                    <mo>∗</mo>
                  </mrow>
                </msup>
              </mrow>
              <annotation encoding="application/x-tex">z^{(s)*}</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                  class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span
                        style="top:-3.063em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mopen mtight">(</span><span
                              class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span><span
                              class="mord mtight">∗</span></span></span></span></span></span></span></span></span></span></span></span>
    </eq> are similar through an additional loss function. These ideas are inspired from:</p>
  <ul>
    <li data-line="160" class="code-line"><a
        href="https://openaccess.thecvf.com/content_CVPR_2020/html/Rao_RL-CycleGAN_Reinforcement_Learning_Aware_Simulation-to-Real_CVPR_2020_paper.html"
        data-href="https://openaccess.thecvf.com/content_CVPR_2020/html/Rao_RL-CycleGAN_Reinforcement_Learning_Aware_Simulation-to-Real_CVPR_2020_paper.html">RL
        Cycle-GAN</a></li>
    <li data-line="161" class="code-line"><a
        href="https://openaccess.thecvf.com/content_CVPR_2019/papers/James_Sim-To-Real_via_Sim-To-Sim_Data-Efficient_Robotic_Grasping_via_Randomized-To-Canonical_Adaptation_Networks_CVPR_2019_paper.pdf"
        data-href="https://openaccess.thecvf.com/content_CVPR_2019/papers/James_Sim-To-Real_via_Sim-To-Sim_Data-Efficient_Robotic_Grasping_via_Randomized-To-Canonical_Adaptation_Networks_CVPR_2019_paper.pdf">Sim2Real
        Robotic Grasping</a></li>
  </ul>
  <p data-line="163" class="code-line">The latter paper makes use of domain randomization, of which there are many
    variants <a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=8202133"
      data-href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=8202133">i</a> <a
      href="https://openaccess.thecvf.com/content_ICCV_2019/papers/Zakharov_DeceptionNet_Network-Driven_Domain_Randomization_ICCV_2019_paper.pdf"
      data-href="https://openaccess.thecvf.com/content_ICCV_2019/papers/Zakharov_DeceptionNet_Network-Driven_Domain_Randomization_ICCV_2019_paper.pdf">ii</a>
    <a href="http://proceedings.mlr.press/v100/mehta20a/mehta20a.pdf"
      data-href="http://proceedings.mlr.press/v100/mehta20a/mehta20a.pdf">iii</a> <a
      href="https://openaccess.thecvf.com/content_cvpr_2018_workshops/papers/w14/Tremblay_Training_Deep_Networks_CVPR_2018_paper.pdf"
      data-href="https://openaccess.thecvf.com/content_cvpr_2018_workshops/papers/w14/Tremblay_Training_Deep_Networks_CVPR_2018_paper.pdf">iv</a>.
  </p>
  <p data-line="165" class="code-line">Another more radical approach to this problem is meta-reinforcement learning, of
    which <a href="https://www.nature.com/articles/s41593-018-0147-8/briefing/signup/"
      data-href="https://www.nature.com/articles/s41593-018-0147-8/briefing/signup/">this</a> is a good paper.
    Meta-reinforcement learning refers to the idea of 'learning to learn', where instead of trying to fit a neural
    network as a function approximator to a transformation between data distributions, the neural network is trained as
    a function approximator to the dynamics of learning itself. That is, given the typical SARSA MDP structure, the
    neural network takes into account the previous action and reward to modify its internal state memory, such that
    actions from this internal state memory optimizes for the reward. Applying this concept here would likely be a first
    because in this scenario, the actions would be a transformation of image states between domains, while the rewards
    are received only after passing through several other networks. Due to this, I think this idea will be very
    difficult to execute due to the long horizon problem of rewards, as well as the very high dimensional problem that
    state representation is.</p>
  <hr>
  <h2 id="recurrent-state-space-model-rssm" data-line="171" class="code-line">Recurrent State Space Model (RSSM)</h2>
  <p data-line="172" class="code-line">Online reinforcement learning is not data efficient. Many attributes cause this,
    most notable the sparsity of rewards and the exploration issue with learning from existing data. To circumvent this,
    many model-based reinforcement learning architectures have been proposed, where a world model is learned via
    supervised learning, and then reinforcement learning is done using this world model. This is the exact approach used
    here, except with latent space variables.</p>
  <blockquote data-line="175" class="code-line">
    <p data-line="175" class="code-line">We denote the latent state space variable here as <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                  <mo>∈</mo>
                  <mi>Z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z \in Z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.07153em;">Z</span></span></span></span></eq>, but note that there are two possible
      formulations for this latent space variable. The first is as described in the <a href="#state-encoder"
        data-href="#state-encoder">state encoder</a>, but an alternate, more sensible approach, is to have <eq><span
          class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>s</mi>
                  <mo>∈</mo>
                  <mi>S</mi>
                </mrow>
                <annotation encoding="application/x-tex">s \in S</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">s</span><span
                class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span
                class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.05764em;">S</span></span></span></span></eq> be solely derived from <eq><span
          class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>X</mi>
                </mrow>
                <annotation encoding="application/x-tex">X</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.07847em;">X</span></span></span></span></eq>, and then concatenate <eq><span
          class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>q</mi>
                  <mo>∈</mo>
                  <mi>Q</mi>
                </mrow>
                <annotation encoding="application/x-tex">q \in Q</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault"
                style="margin-right:0.03588em;">q</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span
                class="mord mathdefault">Q</span></span></span></span></eq> into <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span></span></span></span></eq>. That way, the state encoder is only
      used to encode the perceptual camera information, and the sensor measurements taken by the IMU (or optionally
      filtered and estimated position, velocity, etc) be kept as a separate variable, simply concatenated to the latent
      variable. For brevity, I will just refer to this variable as a latent state variable <eq><span class="katex"><span
            class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <mi>z</mi>
                  <mo>∈</mo>
                  <mi>Z</mi>
                </mrow>
                <annotation encoding="application/x-tex">z \in Z</annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault"
                style="margin-right:0.07153em;">Z</span></span></span></span></eq>.</p>
  </blockquote>
  <p data-line="177" class="code-line">The RSSM's main goal is to predict the next state and reward given the current
    state and action pair, where the states are represented as latent state variables. If we assume that the whole
    process is first-order Markovian (as in a fully observable MDP), then it is sufficient for the neural networok to be
    a normal feedforward network. However, most of the time, such complex systems are partially observable, thus the
    Markovian nature is very difficult to be enforced. For this reason, it is likely that a recurrent model should be
    used for the RSSM instead, in the form of a GRU, LSTM, simple RNN, or optionally a Transformer. Thus, we introduce a
    recurrent variable here as <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>h</mi>
              </mrow>
              <annotation encoding="application/x-tex">h</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.69444em;vertical-align:0em;"></span><span
              class="mord mathdefault">h</span></span></span></span></eq>. The RSSM is then described by <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mo stretchy="false">(</mo>
                <msub>
                  <mi>z</mi>
                  <mi>i</mi>
                </msub>
                <mo separator="true">,</mo>
                <msub>
                  <mi>r</mi>
                  <mi>i</mi>
                </msub>
                <mo stretchy="false">)</mo>
                <mo>∼</mo>
                <msub>
                  <mi>f</mi>
                  <mi>θ</mi>
                </msub>
                <mo stretchy="false">(</mo>
                <msub>
                  <mi>z</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
                <mo separator="true">,</mo>
                <msub>
                  <mi>a</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
                <mo separator="true">,</mo>
                <msub>
                  <mi>h</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">(z_i, r_i) \sim f_{\theta}(z_{i-1}, a_{i-1}, h_{i-1})
              </annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span
              class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
              class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
            class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.33610799999999996em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight"
                              style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                              class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                              class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span><span
              class="mclose">)</span></span></span></span></eq>. Note that this process is deterministic. The recurrent
    varialble can then be a distribution of several things; <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>h</mi>
                  <mi>i</mi>
                </msub>
                <mo>∼</mo>
                <mi>g</mi>
                <mo stretchy="false">(</mo>
                <mo>∙</mo>
                <mi mathvariant="normal">∣</mi>
                <msub>
                  <mi>z</mi>
                  <mi>i</mi>
                </msub>
                <mo separator="true">,</mo>
                <msub>
                  <mi>h</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
                <mo separator="true">,</mo>
                <mi mathvariant="normal">.</mi>
                <mi mathvariant="normal">.</mi>
                <mi mathvariant="normal">.</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">h_i \sim g(\bullet | z_i, h_{i-1}, ...)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault"
              style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">∙</span><span
              class="mord">∣</span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight">i</span><span
                              class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span
              class="mclose">)</span></span></span></span></eq>, note that this is not a neural network process, but a
    fixed stochastic operation.</p>
  <hr>
  <h2 id="reinforcement-learning-model-actor-critic--ac" data-line="181" class="code-line">Reinforcement Learning Model
    (Actor Critic / AC)</h2>
  <p data-line="182" class="code-line">The AC model will arguably be the most touchy component of the whole system
    architecture, but its core concept is the easiest to understand. The base idea is to have the actor produce a
    distribution over the action space of the most likely action that will maximize the expected sum of future
    discounted rewards. Ie:</p>
  <section>
    <eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <munder>
                    <mo>
                      <mi>max</mi>
                      <mo>⁡</mo>
                    </mo>
                    <mi>θ</mi>
                  </munder>
                  <msub>
                    <mi mathvariant="double-struck">E</mi>
                    <mrow>
                      <msub>
                        <mi>z</mi>
                        <mi>i</mi>
                      </msub>
                      <mo>∼</mo>
                      <mi>c</mi>
                      <mo stretchy="false">(</mo>
                      <mo>∙</mo>
                      <mi mathvariant="normal">∣</mi>
                      <msub>
                        <mi>z</mi>
                        <mrow>
                          <mi>i</mi>
                          <mo>−</mo>
                          <mn>1</mn>
                        </mrow>
                      </msub>
                      <mo separator="true">,</mo>
                      <mover accent="true">
                        <mi>a</mi>
                        <mo>^</mo>
                      </mover>
                      <mo stretchy="false">)</mo>
                      <mo separator="true">,</mo>
                      <mover accent="true">
                        <mi>a</mi>
                        <mo>^</mo>
                      </mover>
                      <mo>∼</mo>
                      <msub>
                        <mi>π</mi>
                        <mi>θ</mi>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <mo>∙</mo>
                      <mi mathvariant="normal">∣</mi>
                      <mi>z</mi>
                      <mo stretchy="false">)</mo>
                    </mrow>
                  </msub>
                  <msub>
                    <mi>V</mi>
                    <mi>i</mi>
                  </msub>
                  <mspace linebreak="newline"></mspace>
                  <msub>
                    <mi>V</mi>
                    <mi>i</mi>
                  </msub>
                  <mo>=</mo>
                  <munderover>
                    <mo>∑</mo>
                    <mrow>
                      <mi>t</mi>
                      <mo>=</mo>
                      <mi>i</mi>
                    </mrow>
                    <mi>T</mi>
                  </munderover>
                  <msup>
                    <mi>γ</mi>
                    <mrow>
                      <mi>t</mi>
                      <mo>−</mo>
                      <mi>i</mi>
                    </mrow>
                  </msup>
                  <msub>
                    <mi>r</mi>
                    <mi>t</mi>
                  </msub>
                </mrow>
                <annotation encoding="application/x-tex">
                  \max_\theta \mathbb{E}_{z_i \sim c(\bullet | z_{i-1}, \hat{a}), \hat{a} \sim \pi_\theta(\bullet | z)}
                  V_i \\
                  V_i = \sum_{t=i}^{T} \gamma^{t-i} r_t
                </annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:1.440998em;vertical-align:-0.752108em;"></span><span class="mop op-limits"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.43055999999999994em;"><span style="top:-2.347892em;margin-left:0em;"><span
                          class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight" style="margin-right:0.02778em;">θ</span></span></span><span
                        style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span
                            class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span
                    class="vlist-r"><span class="vlist"
                      style="height:0.752108em;"><span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span
                    class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span
                          style="top:-2.5198em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight"
                                  style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.3280857142857143em;"><span
                                          style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span
                                            class="pstrut" style="height:2.5em;"></span><span
                                            class="sizing reset-size3 size1 mtight"><span
                                              class="mord mathdefault mtight">i</span></span></span></span><span
                                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                        style="height:0.143em;"><span></span></span></span></span></span></span><span
                                class="mrel mtight">∼</span><span class="mord mathdefault mtight">c</span><span
                                class="mopen mtight">(</span><span class="mord mtight">∙</span><span
                                class="mord mtight">∣</span><span class="mord mtight"><span
                                  class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span
                                  class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span
                                        class="vlist" style="height:0.32808571428571426em;"><span
                                          style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span
                                            class="pstrut" style="height:2.5em;"></span><span
                                            class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span
                                                class="mord mathdefault mtight">i</span><span
                                                class="mbin mtight">−</span><span
                                                class="mord mtight">1</span></span></span></span></span><span
                                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                        style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span
                                class="mpunct mtight">,</span><span class="mord accent mtight"><span
                                  class="vlist-t"><span class="vlist-r"><span class="vlist"
                                      style="height:0.69444em;"><span style="top:-2.7em;"><span class="pstrut"
                                          style="height:2.7em;"></span><span class="mord mtight"><span
                                            class="mord mathdefault mtight">a</span></span></span><span
                                        style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span
                                          class="accent-body" style="left:-0.25em;"><span
                                            class="mord mtight">^</span></span></span></span></span></span></span><span
                                class="mclose mtight">)</span><span class="mpunct mtight">,</span><span
                                class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span
                                      class="vlist" style="height:0.69444em;"><span style="top:-2.7em;"><span
                                          class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span
                                            class="mord mathdefault mtight">a</span></span></span><span
                                        style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span
                                          class="accent-body" style="left:-0.25em;"><span
                                            class="mord mtight">^</span></span></span></span></span></span></span><span
                                class="mrel mtight">∼</span><span class="mord mtight"><span
                                  class="mord mathdefault mtight" style="margin-right:0.03588em;">π</span><span
                                  class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span
                                        class="vlist" style="height:0.3448em;"><span
                                          style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span
                                            class="pstrut" style="height:2.5em;"></span><span
                                            class="sizing reset-size3 size1 mtight"><span
                                              class="mord mathdefault mtight"
                                              style="margin-right:0.02778em;">θ</span></span></span></span><span
                                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                        style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span
                                class="mopen mtight">(</span><span class="mord mtight">∙</span><span
                                class="mord mtight">∣</span><span class="mord mathdefault mtight"
                                style="margin-right:0.04398em;">z</span><span
                                class="mclose mtight">)</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span
                class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span
                  class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span></span><span
              class="mspace newline"></span><span class="base"><span class="strut"
                style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span
                          class="pstrut" style="height:3.05em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight">t</span><span class="mrel mtight">=</span><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span
                            class="mop op-symbol large-op">∑</span></span></span><span
                        style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut"
                          style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mtight"><span class="mord mathdefault mtight"
                              style="margin-right:0.13889em;">T</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault"
                  style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t"><span
                      class="vlist-r"><span class="vlist" style="height:0.874664em;"><span
                          style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mtight"><span class="mord mathdefault mtight">t</span><span
                                class="mbin mtight">−</span><span
                                class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span></span><span
                class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                  class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.2805559999999999em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">t</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    </eqn>
  </section>
  <p data-line="189" class="code-line">where <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>γ</mi>
              </mrow>
              <annotation encoding="application/x-tex">\gamma</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault"
              style="margin-right:0.05556em;">γ</span></span></span></span></eq> is some discount factor in <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mo stretchy="false">[</mo>
                <mn>0</mn>
                <mo separator="true">,</mo>
                <mn>1</mn>
                <mo stretchy="false">]</mo>
              </mrow>
              <annotation encoding="application/x-tex">[0, 1]</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span
              class="mord">0</span><span class="mpunct">,</span><span class="mspace"
              style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span
              class="mclose">]</span></span></span></span></eq>, usually chosen in the range of 0.9. And the expectation
    is done over the state transition distribution <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>z</mi>
                  <mi>i</mi>
                </msub>
                <mo>∼</mo>
                <mi>c</mi>
                <mo stretchy="false">(</mo>
                <mo>∙</mo>
                <mi mathvariant="normal">∣</mi>
                <msub>
                  <mi>z</mi>
                  <mrow>
                    <mi>i</mi>
                    <mo>−</mo>
                    <mn>1</mn>
                  </mrow>
                </msub>
                <mo separator="true">,</mo>
                <mi>a</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">z_i \sim c(\bullet | z_{i-1}, a)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault"
                style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
              style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
              style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span
              class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                              class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                              class="mord mtight">1</span></span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.208331em;"><span></span></span></span></span></span></span><span
              class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
              class="mord mathdefault">a</span><span class="mclose">)</span></span></span></span></eq> and actions are
    taken according to an action policy <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>a</mi>
                <mo>∼</mo>
                <msub>
                  <mi>π</mi>
                  <mi>θ</mi>
                </msub>
                <mo stretchy="false">(</mo>
                <mo>∙</mo>
                <mi mathvariant="normal">∣</mi>
                <mi>z</mi>
                <mo stretchy="false">)</mo>
              </mrow>
              <annotation encoding="application/x-tex">a \sim \pi_\theta(\bullet | z)</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span
              class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
              class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span
                class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="msupsub"><span
                  class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                      style="height:0.33610799999999996em;"><span
                        style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                          class="pstrut" style="height:2.7em;"></span><span
                          class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight"
                            style="margin-right:0.02778em;">θ</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span><span
              class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span class="mord mathdefault"
              style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span></eq>.</p>
  <p data-line="191" class="code-line">There exist several methods of solving this problem, the popular and successful
    ones are usually simple to understand with slightly involved math. I will just link some of the more popular ones
    here with increasing levels of difficulty, we'll likely use the last one on the list because it doesn't require use
    of an actor network, and simply treats the problem as querying an oracle critic network for continuous spaces:</p>
  <ul>
    <li data-line="192" class="code-line"><a href="http://proceedings.mlr.press/v32/silver14.html"
        data-href="http://proceedings.mlr.press/v32/silver14.html">Deterministic Policy Gradient</a></li>
    <li data-line="193" class="code-line"><a href="https://arxiv.org/abs/1707.06347"
        data-href="https://arxiv.org/abs/1707.06347">Proximal Policy Optimization</a></li>
    <li data-line="194" class="code-line"><a href="https://arxiv.org/abs/1502.05477"
        data-href="https://arxiv.org/abs/1502.05477">Trust Region Policy Optimization</a></li>
    <li data-line="195" class="code-line"><a href="http://proceedings.mlr.press/v89/jankowiak19a/jankowiak19a.pdf"
        data-href="http://proceedings.mlr.press/v89/jankowiak19a/jankowiak19a.pdf">Pathwise Derivatives</a></li>
    <li data-line="196" class="code-line"><a href="https://arxiv.org/abs/2006.05990"
        data-href="https://arxiv.org/abs/2006.05990">What matters in on policy learning? A large scale empirical
        study</a></li>
    <li data-line="197" class="code-line"><a href="https://arxiv.org/abs/1506.02438"
        data-href="https://arxiv.org/abs/1506.02438">Generalized Advantage Estimation</a></li>
    <li data-line="198" class="code-line"><a href="https://arxiv.org/abs/1806.10293"
        data-href="https://arxiv.org/abs/1806.10293">QT-OPT</a></li>
  </ul>
  <p data-line="200" class="code-line">Optionally, read this <a
      href="https://lilianweng.github.io/lil-log/2018/02/19/a-long-peek-into-reinforcement-learning.html"
      data-href="https://lilianweng.github.io/lil-log/2018/02/19/a-long-peek-into-reinforcement-learning.html">blog
      post</a> on reinforcement learning algorithms and <a
      href="https://lilianweng.github.io/lil-log/2018/04/08/policy-gradient-algorithms.html"
      data-href="https://lilianweng.github.io/lil-log/2018/04/08/policy-gradient-algorithms.html">this excellent
      blog</a> post on all current SOTA reinforcement learning algorithms for on policy learning.</p>
  <p data-line="202" class="code-line">In short, the actor critic model requires an action value distribution
    approximator and a value function approximator, both in the form of neural netowrks:</p>
  <section>
    <eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math
              xmlns="http://www.w3.org/1998/Math/MathML">
              <semantics>
                <mrow>
                  <msub>
                    <mover accent="true">
                      <mi>a</mi>
                      <mo>^</mo>
                    </mover>
                    <mi>i</mi>
                  </msub>
                  <mo>∼</mo>
                  <msub>
                    <mi>π</mi>
                    <mrow>
                      <mi>a</mi>
                      <mo separator="true">,</mo>
                      <mi>θ</mi>
                    </mrow>
                  </msub>
                  <mo stretchy="false">(</mo>
                  <mo>∙</mo>
                  <mi mathvariant="normal">∣</mi>
                  <msub>
                    <mi>z</mi>
                    <mi>i</mi>
                  </msub>
                  <mo stretchy="false">)</mo>
                  <mspace linebreak="newline"></mspace>
                  <msub>
                    <mover accent="true">
                      <mi>V</mi>
                      <mo>^</mo>
                    </mover>
                    <mi>i</mi>
                  </msub>
                  <mo>=</mo>
                  <msub>
                    <mi>π</mi>
                    <mrow>
                      <mi>v</mi>
                      <mo separator="true">,</mo>
                      <mi>θ</mi>
                    </mrow>
                  </msub>
                  <mo stretchy="false">(</mo>
                  <msub>
                    <mi>z</mi>
                    <mi>i</mi>
                  </msub>
                  <mo stretchy="false">)</mo>
                </mrow>
                <annotation encoding="application/x-tex">
                  \hat{a}_i \sim \pi_{a, \theta}(\bullet | z_i) \\
                  \hat{V}_i = \pi_{v, \theta}(z_i)
                </annotation>
              </semantics>
            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                        style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                            style="height:3em;"></span><span class="mord"><span
                              class="mord mathdefault">a</span></span></span><span style="top:-3em;"><span
                            class="pstrut" style="height:3em;"></span><span class="accent-body"
                            style="left:-0.25em;"><span
                              class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.3361079999999999em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                class="mord mathdefault mtight">a</span><span class="mpunct mtight">,</span><span
                                class="mord mathdefault mtight"
                                style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.286108em;"><span></span></span></span></span></span></span><span
                class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut"
                style="height:1.0967699999999998em;vertical-align:-0.15em;"></span><span class="mord"><span
                  class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                        style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut"
                            style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                              style="margin-right:0.22222em;">V</span></span></span><span style="top:-3.25233em;"><span
                            class="pstrut" style="height:3em;"></span><span class="accent-body"
                            style="left:-0.25em;"><span
                              class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                            style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                  class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                        style="height:0.3361079999999999em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span
                                class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                                style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.286108em;"><span></span></span></span></span></span></span><span
                class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                  style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                      class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                          style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                            class="pstrut" style="height:2.7em;"></span><span
                            class="sizing reset-size6 size3 mtight"><span
                              class="mord mathdefault mtight">i</span></span></span></span><span
                        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                class="mclose">)</span></span></span></span></span></eqn>
  </section>
  <hr>
  <h2 id="putting-everything-together" data-line="211" class="code-line">Putting Everything Together</h2>
  <p data-line="212" class="code-line">Thus far, we have:</p>
  <ul>
    <li data-line="213" class="code-line"><a href="#state-encoder-se" data-href="#state-encoder-se">The State Encoder
        (and decoder)</a>
      <ul>
        <li data-line="214" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mi>z</mi>
                      <mo>∼</mo>
                      <msub>
                        <mi>p</mi>
                        <mrow>
                          <mi>e</mi>
                          <mo separator="true">,</mo>
                          <mi>θ</mi>
                        </mrow>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <mo>∙</mo>
                      <mi mathvariant="normal">∣</mi>
                      <mi>s</mi>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">z \sim p_{e, \theta} (\bullet | s)</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault"
                    style="margin-right:0.04398em;">z</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                      class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">e</span><span class="mpunct mtight">,</span><span
                                    class="mord mathdefault mtight"
                                    style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.286108em;"><span></span></span></span></span></span></span><span
                    class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span
                    class="mord mathdefault">s</span><span class="mclose">)</span></span></span></span></eq>
        </li>
        <li data-line="215" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mover accent="true">
                        <mi>s</mi>
                        <mo>^</mo>
                      </mover>
                      <mo>∼</mo>
                      <msub>
                        <mi>p</mi>
                        <mrow>
                          <mi>d</mi>
                          <mo separator="true">,</mo>
                          <mi>θ</mi>
                        </mrow>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <mo>∙</mo>
                      <mi mathvariant="normal">∣</mi>
                      <mi>z</mi>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">\hat{s} \sim p_{d, \theta} (\bullet | z)</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.69444em;vertical-align:0em;"></span><span class="mord accent"><span
                      class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span
                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span
                                class="mord mathdefault">s</span></span></span><span style="top:-3em;"><span
                              class="pstrut" style="height:3em;"></span><span class="accent-body"
                              style="left:-0.19444em;"><span
                                class="mord">^</span></span></span></span></span></span></span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                      class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">d</span><span class="mpunct mtight">,</span><span
                                    class="mord mathdefault mtight"
                                    style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.286108em;"><span></span></span></span></span></span></span><span
                    class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span
                    class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
                    class="mclose">)</span></span></span></span></eq>
        </li>
      </ul>
    </li>
    <li data-line="216" class="code-line"><a href="#recurrent-state-space-model-rssm"
        data-href="#recurrent-state-space-model-rssm">The Recurrent State Space Model</a>
      <ul>
        <li data-line="217" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <mo stretchy="false">(</mo>
                      <msub>
                        <mi>z</mi>
                        <mi>i</mi>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>r</mi>
                        <mi>i</mi>
                      </msub>
                      <mo stretchy="false">)</mo>
                      <mo>=</mo>
                      <msub>
                        <mi>f</mi>
                        <mi>θ</mi>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <msub>
                        <mi>z</mi>
                        <mrow>
                          <mi>i</mi>
                          <mo>−</mo>
                          <mn>1</mn>
                        </mrow>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>a</mi>
                        <mrow>
                          <mi>i</mi>
                          <mo>−</mo>
                          <mn>1</mn>
                        </mrow>
                      </msub>
                      <mo separator="true">,</mo>
                      <msub>
                        <mi>h</mi>
                        <mrow>
                          <mi>i</mi>
                          <mo>−</mo>
                          <mn>1</mn>
                        </mrow>
                      </msub>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">(z_i, r_i) = f_{\theta}(z_{i-1}, a_{i-1}, h_{i-1})
                    </annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                    class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault"
                      style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight"
                                    style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                      style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.311664em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                                    class="mord mtight">1</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.208331em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.311664em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                                    class="mord mtight">1</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.208331em;"><span></span></span></span></span></span></span><span
                    class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                    class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.311664em;"><span
                              style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span
                                    class="mord mtight">1</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.208331em;"><span></span></span></span></span></span></span><span
                    class="mclose">)</span></span></span></span></eq>
        </li>
      </ul>
    </li>
    <li data-line="218" class="code-line"><a href="#reinforcement-learning-model-actor-critic--ac"
        data-href="#reinforcement-learning-model-actor-critic--ac">Actor Critic Model</a>
      <ul>
        <li data-line="219" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <msub>
                        <mover accent="true">
                          <mi>V</mi>
                          <mo>^</mo>
                        </mover>
                        <mi>i</mi>
                      </msub>
                      <mo>=</mo>
                      <msub>
                        <mi>π</mi>
                        <mrow>
                          <mi>v</mi>
                          <mo separator="true">,</mo>
                          <mi>θ</mi>
                        </mrow>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <msub>
                        <mi>z</mi>
                        <mi>i</mi>
                      </msub>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">\hat{V}_i = \pi_{v, \theta}(z_i)</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:1.0967699999999998em;vertical-align:-0.15em;"></span><span class="mord"><span
                      class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                            style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut"
                                style="height:3em;"></span><span class="mord"><span class="mord mathdefault"
                                  style="margin-right:0.22222em;">V</span></span></span><span
                              style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span
                                class="accent-body" style="left:-0.25em;"><span
                                  class="mord">^</span></span></span></span></span></span></span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                                style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                      class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.3361079999999999em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span
                                    class="mpunct mtight">,</span><span class="mord mathdefault mtight"
                                    style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.286108em;"><span></span></span></span></span></span></span><span
                    class="mopen">(</span><span class="mord"><span class="mord mathdefault"
                      style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                          class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">)</span></span></span></span></eq>
        </li>
        <li data-line="220" class="code-line">
          <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                  <semantics>
                    <mrow>
                      <msub>
                        <mover accent="true">
                          <mi>a</mi>
                          <mo>^</mo>
                        </mover>
                        <mi>i</mi>
                      </msub>
                      <mo>∼</mo>
                      <msub>
                        <mi>π</mi>
                        <mrow>
                          <mi>a</mi>
                          <mo separator="true">,</mo>
                          <mi>θ</mi>
                        </mrow>
                      </msub>
                      <mo stretchy="false">(</mo>
                      <mo>∙</mo>
                      <mi mathvariant="normal">∣</mi>
                      <msub>
                        <mi>z</mi>
                        <mi>i</mi>
                      </msub>
                      <mo stretchy="false">)</mo>
                    </mrow>
                    <annotation encoding="application/x-tex">\hat{a}_i \sim \pi_{a, \theta}(\bullet | z_i)</annotation>
                  </semantics>
                </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                    style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span
                      class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                            style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut"
                                style="height:3em;"></span><span class="mord"><span
                                  class="mord mathdefault">a</span></span></span><span style="top:-3em;"><span
                                class="pstrut" style="height:3em;"></span><span class="accent-body"
                                style="left:-0.25em;"><span
                                  class="mord">^</span></span></span></span></span></span></span><span
                      class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut"
                                style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace"
                    style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut"
                    style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span
                      class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.3361079999999999em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                    class="mord mathdefault mtight">a</span><span class="mpunct mtight">,</span><span
                                    class="mord mathdefault mtight"
                                    style="margin-right:0.02778em;">θ</span></span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.286108em;"><span></span></span></span></span></span></span><span
                    class="mopen">(</span><span class="mord">∙</span><span class="mord">∣</span><span class="mord"><span
                      class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span
                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                            style="height:0.31166399999999994em;"><span
                              style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span
                                class="pstrut" style="height:2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span
                                  class="mord mathdefault mtight">i</span></span></span></span><span
                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                    class="mclose">)</span></span></span></span></eq>
        </li>
      </ul>
    </li>
  </ul>
  <p data-line="222" class="code-line">To preface, the base idea is to train the AC model on the imagined latent states
    generated by the RSSM, rolled out for <eq><span class="katex"><span class="katex-mathml"><math
            xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>n</mi>
              </mrow>
              <annotation encoding="application/x-tex">n</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.43056em;vertical-align:0em;"></span><span
              class="mord mathdefault">n</span></span></span></span></eq> steps into the future at a time.</p>
  <p data-line="224" class="code-line">There are two main regimes for the training of this system.</p>
  <ul>
    <li data-line="225" class="code-line"><a href="#model-learning" data-href="#model-learning">Model Learning</a>
      <ul>
        <li data-line="226" class="code-line">This is where the dataset is used to build the RSSM and the SE</li>
      </ul>
    </li>
    <li data-line="227" class="code-line"><a href="#reinforcement-learning"
        data-href="#reinforcement-learning">Reinforcement Learning</a>
      <ul>
        <li data-line="228" class="code-line">This is where the actual training of the actor critic agent is done</li>
      </ul>
    </li>
  </ul>
  <p data-line="230" class="code-line">After these two are done, the system is decomposed to its core components, and a
    subset of them are used during <a href="#deployment" data-href="#deployment">deployment</a>.</p>
  <h3 id="model-learning" data-line="232" class="code-line">Model Learning</h3>
  <p data-line="233" class="code-line">In this stage of learning, we first train the SE using the dataset. Training to
    completion may not be too beneficial, but this remains to be seen. Regardless, some pre-training is required to
    allow the RSSM to have reasonable latent space variables to regress to, which is done right after the SE is
    trained/half-trained. A figure depicting this step of the training regime is shown here (dotted lines represent KL
    loss, or a loss function between two distributions):</p>
  <p data-line="235" class="code-line"><img src="RSSM%20SE%20training.png" alt="RSSM SE training" class="loading"
      id="image-hash--115948057"></p>
  <hr>
  <h3 id="agent-learning" data-line="238" class="code-line">Agent Learning</h3>
  <p data-line="239" class="code-line">Once the world model is suitably learned, it can then be used to train the
    reinforcement learning agent. This is much more efficient because now, the state of the world is encoded in a
    compressed form, and performing computations on this compressed state representation accelerates learning by
    allowing training to be done in very large batch sizes. To train, we simply encode a state <eq><span
        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <msub>
                  <mi>s</mi>
                  <mi>i</mi>
                </msub>
              </mrow>
              <annotation encoding="application/x-tex">s_i</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span
                class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                    class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span
                        style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut"
                          style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span
                            class="mord mathdefault mtight">i</span></span></span></span><span
                      class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                      style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>
    at a time <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
            <semantics>
              <mrow>
                <mi>t</mi>
              </mrow>
              <annotation encoding="application/x-tex">t</annotation>
            </semantics>
          </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
              style="height:0.61508em;vertical-align:0em;"></span><span
              class="mord mathdefault">t</span></span></span></span></eq> using the encoder, and then use the RSSM to
    perform rollouts given actions from the actor critic model. These rollouts can be performed in the field of ~5
    seconds to prevent the RSSM from accumulating errors and venturing into unrepresented areas of the state space.
    Given that the dataset is full of state data, we can then randomly sample the initial image from the dataset, and
    then perform rollouts on each image. This is graphically represented as (dotted lines represent learning signal from
    reward function):</p>
  <p data-line="241" class="code-line"><img src="AC%20learning.png" alt="AC learning" class="loading"
      id="image-hash--11889903"></p>
  <blockquote data-line="243" class="code-line">
    <p data-line="243" class="code-line">Optionally, to accelerate learning, we can also use mimic learning via
      supervised learning to first learn a good set of actions to take given states from the dataset. Once this is
      learned sufficiently well, reinforcement learning can be used to fine tune the actor to take more optimal actions.
      This is shown as:</p>
    <p data-line="245" class="code-line"><img src="AC%20prelearning.png" alt="AC prelearning \label{prelearning}"
        class="loading" id="image-hash-1777510084"></p>
  </blockquote>
  <h3 id="deployment" data-line="247" class="code-line">Deployment</h3>
  <p data-line="248" class="code-line">Finally, in deployment, we discard everything but the most essential.
    Effectively, we replicate the operation shown in the prior image, but this time, actions are directly taken onto the
    world state instead. The RSSM and decoder are not used.</p>
  <p data-line="250" class="code-line">Ideally, the system should be trained in a recurring fashion, that is, after
    training on the initial dataset, the system should be allowed to interact with the environment on its own and
    collect additional data to be added to the dataset, and then retrained on this additional data. This should be done
    for several episodes until an optimum level of performance is achieved.</p>
  <h3 id="active-learning" data-line="252" class="code-line">Active Learning</h3>
  <p data-line="253" class="code-line">During complete deployment, there is an option to perform active learning with
    the system. Because the computer vision model conveniently outputs a measure of performance, we can use this metric
    to detect instances where the model is having trouble with its task. These instances can then be collected, and the
    network explicitly trained on these scenarios after the fact. This is known as hard negative mining.</p>


  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
    integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous">
  </script>
</body>

</html>